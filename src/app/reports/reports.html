<app-side-bar (collapsedChange)="onSidebarToggle($event)"></app-side-bar>

<!-- ===== TOP NAV ===== -->
<nav class="top-nav" [class.sidebar-collapsed]="isSidebarCollapsed">
  <div class="nav-left">
    <div>
      <div class="nav-page-title">ุงูุชูุงุฑูุฑ</div>
      <div class="nav-page-sub">ุฃูุดุฆ ูุญููู ุชูุงุฑูุฑู ุจุณูููุฉ</div>
    </div>
  </div>
  <div class="nav-right">
    <button class="btn-add" (click)="createNewReport()">
      <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/></svg>
      ุชูุฑูุฑ ุฌุฏูุฏ
    </button>
    <button class="guide-btn" (click)="openGuide()">
      <svg viewBox="0 0 16 16" fill="white"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/></svg>
      ุฏููู ุงูุงุณุชุฎุฏุงู
    </button>
  </div>
</nav>

<!-- ===== GUIDE MODAL ===== -->
<div class="modal-overlay" *ngIf="showGuide" (click)="closeGuide()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>๐ ุฏููู ุงุณุชุฎุฏุงู ุงูุชูุงุฑูุฑ</h3>
      <button class="close-btn" (click)="closeGuide()">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <p class="guide-intro">ุฃูุดุฆ ุชูุงุฑูุฑ ุงุญุชุฑุงููุฉ ููุดุฑูุนู ุจุถุบุทุฉ ุฒุฑ ูุงุญุฏุฉ.</p>
      <div class="guide-features">
        <div class="guide-item"><span class="guide-icon">๐</span><div><h4>ููุงูุจ ุฌุงูุฒุฉ</h4><p>ุงุฎุชุฑ ูู ุจูู ูฆ ููุงูุจ ุชูุงุฑูุฑ ูุชุฎุตุตุฉ</p></div></div>
        <div class="guide-item"><span class="guide-icon">๐ฅ</span><div><h4>ุชุญููู ููุฑู</h4><p>ุญููู ุชูุงุฑูุฑู ุจุตูุบุฉ PDF ุฃู Excel</p></div></div>
        <div class="guide-item"><span class="guide-icon">โ๏ธ</span><div><h4>ุชูุงุฑูุฑ ูุฎุตุตุฉ</h4><p>ุงุฎุชุฑ ุงูุฃูุณุงู ุงูุชู ุชุฑูุฏ ุชุถููููุง ุจุญุฑูุฉ</p></div></div>
        <div class="guide-item"><span class="guide-icon">๐ค</span><div><h4>ูุดุงุฑูุฉ ุณููุฉ</h4><p>ุดุงุฑู ุชูุงุฑูุฑู ูุน ูุฑููู ุจููุฑุฉ ูุงุญุฏุฉ</p></div></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-primary" (click)="closeGuide()">ูููุชุ ุดูุฑุงู</button>
    </div>
  </div>
</div>

<!-- ===== CREATE REPORT MODAL ===== -->
<div class="modal-overlay" *ngIf="showCreateModal" (click)="cancelReportGeneration()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>๐ ุฅูุดุงุก ุชูุฑูุฑ ุฌุฏูุฏ</h3>
      <button class="close-btn" (click)="cancelReportGeneration()">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">ููุน ุงูุชูุฑูุฑ</label>
        <select [(ngModel)]="reportOptions.type" class="form-input">
          <option value="financial">ุชูุฑูุฑ ูุงูู</option>
          <option value="marketing">ุชูุฑูุฑ ุชุณูููู</option>
          <option value="tasks">ุชูุฑูุฑ ุงูููุงู</option>
          <option value="team">ุชูุฑูุฑ ุงููุฑูู</option>
          <option value="comprehensive">ุชูุฑูุฑ ุดุงูู</option>
        </select>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">ูู ุชุงุฑูุฎ</label>
          <input type="date" [(ngModel)]="reportOptions.startDate" class="form-input">
        </div>
        <div class="form-group">
          <label class="form-label">ุฅูู ุชุงุฑูุฎ</label>
          <input type="date" [(ngModel)]="reportOptions.endDate" class="form-input">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">ุตูุบุฉ ุงูุชูุฑูุฑ</label>
        <div class="format-btns">
          <button class="format-btn" [class.active]="reportOptions.format === 'pdf'" (click)="reportOptions.format = 'pdf'">
            ๐ PDF
          </button>
          <button class="format-btn" [class.active]="reportOptions.format === 'excel'" (click)="reportOptions.format = 'excel'">
            ๐ Excel
          </button>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" (click)="cancelReportGeneration()" [disabled]="isGenerating">ุฅูุบุงุก</button>
      <button class="btn-primary" (click)="generateReport()" [disabled]="isGenerating">
        {{ isGenerating ? 'ุฌุงุฑู ุงูุฅูุดุงุก...' : 'ุฅูุดุงุก ุงูุชูุฑูุฑ' }}
      </button>
    </div>
  </div>
</div>

<!-- ===== CUSTOM REPORT MODAL ===== -->
<div class="modal-overlay" *ngIf="showCustomModal" (click)="cancelReportGeneration()">
  <div class="modal-container modal-lg" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>โ๏ธ ุชูุฑูุฑ ูุฎุตุต</h3>
      <button class="close-btn" (click)="cancelReportGeneration()">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">ุงุฎุชุฑ ุงูุฃูุณุงู ุงููุทููุจุฉ</label>
        <div class="sections-grid">
          <label *ngFor="let section of customSections" class="section-item" [class.selected]="section.selected" (click)="toggleCustomSection(section)">
            <input type="checkbox" [checked]="section.selected" style="display:none">
            <span class="section-check">{{ section.selected ? 'โ' : '' }}</span>
            <span>{{ section.label }}</span>
          </label>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">ูู ุชุงุฑูุฎ</label>
          <input type="date" [(ngModel)]="reportOptions.startDate" class="form-input">
        </div>
        <div class="form-group">
          <label class="form-label">ุฅูู ุชุงุฑูุฎ</label>
          <input type="date" [(ngModel)]="reportOptions.endDate" class="form-input">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">ุตูุบุฉ ุงูุชูุฑูุฑ</label>
        <div class="format-btns">
          <button class="format-btn" [class.active]="reportOptions.format === 'pdf'" (click)="reportOptions.format = 'pdf'">๐ PDF</button>
          <button class="format-btn" [class.active]="reportOptions.format === 'excel'" (click)="reportOptions.format = 'excel'">๐ Excel</button>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" (click)="cancelReportGeneration()" [disabled]="isGenerating">ุฅูุบุงุก</button>
      <button class="btn-primary" (click)="generateReport()" [disabled]="isGenerating">
        {{ isGenerating ? 'ุฌุงุฑู ุงูุฅูุดุงุก...' : 'ุฅูุดุงุก ุงูุชูุฑูุฑ' }}
      </button>
    </div>
  </div>
</div>

<!-- ===== MAIN ===== -->
<main class="reports-main" [class.sidebar-collapsed]="isSidebarCollapsed">

  <!-- Messages -->
  <div class="success-banner" *ngIf="successMessage">
    <svg viewBox="0 0 16 16" fill="currentColor"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M6.97 11.03a.75.75 0 0 0 1.08.022l3.992-4.99a.75.75 0 0 0-1.071-1.05L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06z"/></svg>
    {{ successMessage }}
  </div>
  <div class="error-banner" *ngIf="errorMessage">
    <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/></svg>
    {{ errorMessage }}
  </div>

  <!-- ===== WELCOME ===== -->
  <section class="welcome-section">
    <div class="welcome-content">
      <div class="welcome-text">
        <h1 class="welcome-title">ูุฑูุฒ ุงูุชูุงุฑูุฑ ๐</h1>
        <p class="welcome-sub">ุฃูุดุฆ ุชูุงุฑูุฑ ุงุญุชุฑุงููุฉ ูุชุชุจุน ุฃุฏุงุก ูุดุฑูุนู ุจุฏูุฉ</p>
      </div>
      <div class="welcome-stats">
        <div class="w-stat">
          <span class="w-stat-icon">๐</span>
          <div><span class="w-stat-lbl">ุฅุฌูุงูู ุงูุชูุงุฑูุฑ</span><span class="w-stat-val">{{ totalReports }}</span></div>
        </div>
        <div class="w-stat">
          <span class="w-stat-icon">๐ฅ</span>
          <div><span class="w-stat-lbl">ุนูููุงุช ุงูุชุญููู</span><span class="w-stat-val">{{ totalDownloads }}</span></div>
        </div>
        <div class="w-stat">
          <span class="w-stat-icon">๐๏ธ</span>
          <div><span class="w-stat-lbl">ุงููุดุงูุฏุงุช</span><span class="w-stat-val">{{ totalViews }}</span></div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== METRICS ===== -->
  <section class="metrics-grid">
    <div class="mc">
      <div class="mc-icon">๐</div>
      <div class="mc-lbl">ุฅุฌูุงูู ุงูุชูุงุฑูุฑ</div>
      <div class="mc-val">{{ totalReports }}</div>
      <div class="mini-prog"><div class="mini-prog-fill g" style="width:72%"></div></div>
    </div>
    <div class="mc">
      <div class="mc-icon">๐ฅ</div>
      <div class="mc-lbl">ุงูุชุญูููุงุช</div>
      <div class="mc-val">{{ totalDownloads }}</div>
      <div class="mini-prog"><div class="mini-prog-fill o" style="width:85%"></div></div>
    </div>
    <div class="mc">
      <div class="mc-icon">๐ค</div>
      <div class="mc-lbl">ุงููุดุงุฑูุงุช</div>
      <div class="mc-val">{{ totalShares }}</div>
      <div class="mini-prog"><div class="mini-prog-fill b" style="width:55%"></div></div>
    </div>
    <div class="mc">
      <div class="mc-icon">๐๏ธ</div>
      <div class="mc-lbl">ุงููุดุงูุฏุงุช ุงููููุฉ</div>
      <div class="mc-val">{{ totalViews }}</div>
      <div class="mini-prog"><div class="mini-prog-fill p" style="width:90%"></div></div>
    </div>
  </section>

  <!-- ===== TEMPLATES ===== -->
  <section class="section-block">
    <div class="section-head">
      <div class="section-title">๐ ููุงูุจ ุงูุชูุงุฑูุฑ</div>
      <div class="section-sub">ุงุฎุชุฑ ููุน ุงูุชูุฑูุฑ ุงูุฐู ุชุฑูุฏ ุฅูุดุงุกู</div>
    </div>
    <div class="templates-grid">
      <div class="template-card" *ngFor="let t of reportTemplates" (click)="createReport(t)">
        <div class="template-icon" [style.background]="t.color + '18'" [style.color]="t.color">{{ t.icon }}</div>
        <div class="template-info">
          <div class="template-title">{{ t.title }}</div>
          <div class="template-desc">{{ t.description }}</div>
        </div>
        <button class="template-btn" [style.background]="t.color">
          <svg viewBox="0 0 16 16" fill="white" width="12" height="12"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/></svg>
          ุฅูุดุงุก
        </button>
      </div>
    </div>
  </section>

  <!-- ===== CONTENT ROW ===== -->
  <div class="content-row">

    <!-- Saved Reports -->
    <div class="reports-col">
      <div class="section-block">
        <div class="section-head-row">
          <div>
            <div class="section-title">๐ ุงูุชูุงุฑูุฑ ุงููุญููุธุฉ</div>
            <div class="section-sub">{{ filteredReports.length }} ุชูุฑูุฑ</div>
          </div>
          <div class="filters-row">
            <div class="search-wrap">
              <svg viewBox="0 0 16 16" fill="currentColor"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.099zm-5.242 1.656a5.5 5.5 0 1 1 0-11 5.5 5.5 0 0 1 0 11"/></svg>
              <input type="text" [(ngModel)]="searchQuery" (input)="filterReports()" placeholder="ุจุญุซ ูู ุงูุชูุงุฑูุฑ..." class="search-input">
            </div>
            <select [(ngModel)]="selectedTypeFilter" (change)="filterReports()" class="type-select">
              <option value="all">ูู ุงูุฃููุงุน</option>
              <option value="financial">ูุงูู</option>
              <option value="marketing">ุชุณูููู</option>
              <option value="tasks">ุงูููุงู</option>
              <option value="team">ุงููุฑูู</option>
              <option value="comprehensive">ุดุงูู</option>
            </select>
          </div>
        </div>

        <div class="reports-list">
          <div class="report-card" *ngFor="let report of filteredReports">
            <div class="report-left">
              <div class="report-icon" [ngClass]="'rt-' + report.type">
                {{ report.type === 'financial' ? '๐ฐ' : report.type === 'marketing' ? '๐' : report.type === 'tasks' ? 'โ' : report.type === 'team' ? '๐ฅ' : report.type === 'comprehensive' ? '๐' : 'โ๏ธ' }}
              </div>
              <div class="report-info">
                <div class="report-title">{{ report.title }}</div>
                <div class="report-meta">
                  <span class="report-author">{{ report.author }}</span>
                  <span class="dot">ยท</span>
                  <span class="report-date">{{ report.date }}</span>
                  <span class="dot">ยท</span>
                  <span class="report-views">๐๏ธ {{ report.views }}</span>
                  <span class="dot">ยท</span>
                  <span class="report-format" [class.pdf]="report.format === 'pdf'" [class.excel]="report.format === 'excel'">{{ report.format.toUpperCase() }}</span>
                </div>
              </div>
            </div>
            <div class="report-right">
              <span class="status-badge" [class]="'status-' + report.status">{{ getStatusText(report.status) }}</span>
              <button class="act-btn" (click)="viewReport(report)" title="ุนุฑุถ">
                <svg viewBox="0 0 16 16" fill="currentColor"><path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/><path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/></svg>
              </button>
              <button class="act-btn" (click)="downloadReport(report)" title="ุชุญููู">
                <svg viewBox="0 0 16 16" fill="currentColor"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/><path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/></svg>
              </button>
              <button class="act-btn" (click)="shareReport(report)" title="ูุดุงุฑูุฉ">
                <svg viewBox="0 0 16 16" fill="currentColor"><path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.5 2.5 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5"/></svg>
              </button>
              <button class="act-btn act-del" (click)="deleteReport(report)" title="ุญุฐู">
                <svg viewBox="0 0 16 16" fill="currentColor"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/><path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/></svg>
              </button>
            </div>
          </div>

          <div class="empty-state" *ngIf="filteredReports.length === 0">
            <div class="empty-icon">๐</div>
            <p>ูุง ุชูุฌุฏ ุชูุงุฑูุฑ. ุฃูุดุฆ ุฃูู ุชูุฑูุฑ ูู!</p>
            <button class="btn-primary" (click)="createNewReport()">ุฅูุดุงุก ุชูุฑูุฑ</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Chart Sidebar -->
    <aside class="chart-col">
      <div class="section-block">
        <div class="section-head">
          <div class="section-title">๐ ูุดุงุท ุงูุชูุงุฑูุฑ</div>
          <div class="section-sub">ุขุฎุฑ ูง ุฃุดูุฑ</div>
        </div>
        <div class="chart-wrap">
          <canvas #reportsChart></canvas>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="section-block">
        <div class="section-head">
          <div class="section-title">โก ุฅุฌุฑุงุกุงุช ุณุฑูุนุฉ</div>
        </div>
        <div class="quick-actions">
          <button class="qa-btn" (click)="reportOptions.format='pdf'; reportOptions.type='comprehensive'; showCreateModal=true">
            <span class="qa-icon">๐</span>
            <span>ุชูุฑูุฑ ุดุงูู PDF</span>
            <svg viewBox="0 0 16 16" fill="currentColor" width="12"><path d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708"/></svg>
          </button>
          <button class="qa-btn" (click)="reportOptions.format='excel'; reportOptions.type='financial'; showCreateModal=true">
            <span class="qa-icon">๐ฐ</span>
            <span>ุชูุฑูุฑ ูุงูู Excel</span>
            <svg viewBox="0 0 16 16" fill="currentColor" width="12"><path d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708"/></svg>
          </button>
          <button class="qa-btn" (click)="reportOptions.format='pdf'; reportOptions.type='team'; showCreateModal=true">
            <span class="qa-icon">๐ฅ</span>
            <span>ุชูุฑูุฑ ุงููุฑูู</span>
            <svg viewBox="0 0 16 16" fill="currentColor" width="12"><path d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708"/></svg>
          </button>
          <button class="qa-btn" (click)="showCustomModal=true; reportOptions.type='custom'">
            <span class="qa-icon">โ๏ธ</span>
            <span>ุชูุฑูุฑ ูุฎุตุต</span>
            <svg viewBox="0 0 16 16" fill="currentColor" width="12"><path d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708"/></svg>
          </button>
        </div>
      </div>
    </aside>

  </div>
</main>