<app-side-bar></app-side-bar>

<div class="tasks-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner"></div>
    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…...</p>
  </div>

  <!-- Success/Error Messages -->
  <div *ngIf="successMessage" class="success-banner">
    âœ… {{ successMessage }}
  </div>

  <div *ngIf="errorMessage" class="error-banner">
    âŒ {{ errorMessage }}
  </div>

  <!-- Header -->
  <div class="page-header">
    <div>
      <h1>ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„ÙØ±ÙŠÙ‚</h1>
      <p class="subtitle">Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„Ù…Ù‡Ø§Ù… Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„ØªÙ‡Ø§</p>
    </div>
    <div class="header-actions">
      <button (click)="openNewTaskModal()" class="btn-primary">
        â• Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
      </button>
      <button (click)="refreshTasks()" class="btn-refresh">
        ğŸ”„ ØªØ­Ø¯ÙŠØ«
      </button>
    </div>
  </div>

  <!-- Team Members Section -->
  <div class="team-section">
    <h2>ğŸ‘¥ Ø§Ù„ÙØ±ÙŠÙ‚</h2>
    <div class="team-grid">
      <div *ngFor="let member of teamMembers" class="team-member-card">
        <div class="member-avatar">{{ member.avatar }}</div>
        <div class="member-info">
          <h3>{{ member.name }}</h3>
          <span class="member-tasks">{{ member.tasks }} Ù…Ù‡Ù…Ø©</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Kanban Board with Drag & Drop -->
  <div class="kanban-board">
    
    <!-- Column 1: To Do -->
    <div class="kanban-column">
      <div class="column-header todo-header">
        <h3>ğŸ“ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</h3>
        <span class="task-count">{{ todoCount }}</span>
      </div>
      
      <div 
        class="tasks-list"
        cdkDropList
        #todoList="cdkDropList"
        [cdkDropListData]="todoTasks"
        [cdkDropListConnectedTo]="[inProgressList, reviewList, completedList]"
        (cdkDropListDropped)="drop($event, 'todo')">
        
        <div 
          *ngFor="let task of todoTasks"
          class="task-card"
          cdkDrag
          [cdkDragData]="task"
          [style.border-left-color]="getPriorityColor(task.priority)">
          
          <!-- Drag Handle -->
          <div class="drag-handle" cdkDragHandle>â‹®â‹®</div>
          
          <!-- Task Content -->
          <div class="task-content">
            <h4>{{ task.title }}</h4>
            <p *ngIf="task.description">{{ task.description }}</p>
            
            <!-- Tags -->
            <div *ngIf="task.tags && task.tags.length > 0" class="task-tags">
              <span *ngFor="let tag of task.tags" class="tag">{{ tag }}</span>
            </div>
            
            <!-- Footer -->
            <div class="task-footer">
              <div class="task-meta">
                <span class="task-priority" [style.color]="getPriorityColor(task.priority)">
                  {{ getPriorityLabel(task.priority) }}
                </span>
                <span class="task-date">{{ task.date }}</span>
              </div>
              
              <div class="task-actions">
                <button (click)="deleteTask(task)" class="btn-icon-small" title="Ø­Ø°Ù">
                  ğŸ—‘ï¸
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div *ngIf="todoTasks.length === 0" class="empty-column">
          Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…
        </div>
      </div>
    </div>

    <!-- Column 2: In Progress -->
    <div class="kanban-column">
      <div class="column-header in-progress-header">
        <h3>ğŸ”„ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</h3>
        <span class="task-count">{{ inProgressCount }}</span>
      </div>
      
      <div 
        class="tasks-list"
        cdkDropList
        #inProgressList="cdkDropList"
        [cdkDropListData]="inProgressTasks"
        [cdkDropListConnectedTo]="[todoList, reviewList, completedList]"
        (cdkDropListDropped)="drop($event, 'in-progress')">
        
        <div 
          *ngFor="let task of inProgressTasks"
          class="task-card"
          cdkDrag
          [cdkDragData]="task"
          [style.border-left-color]="getPriorityColor(task.priority)">
          
          <div class="drag-handle" cdkDragHandle>â‹®â‹®</div>
          
          <div class="task-content">
            <h4>{{ task.title }}</h4>
            <p *ngIf="task.description">{{ task.description }}</p>
            
            <div *ngIf="task.tags && task.tags.length > 0" class="task-tags">
              <span *ngFor="let tag of task.tags" class="tag">{{ tag }}</span>
            </div>
            
            <div class="task-footer">
              <div class="task-meta">
                <span class="task-priority" [style.color]="getPriorityColor(task.priority)">
                  {{ getPriorityLabel(task.priority) }}
                </span>
                <span class="task-date">{{ task.date }}</span>
              </div>
              
              <div class="task-actions">
                <button (click)="deleteTask(task)" class="btn-icon-small" title="Ø­Ø°Ù">
                  ğŸ—‘ï¸
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div *ngIf="inProgressTasks.length === 0" class="empty-column">
          Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…
        </div>
      </div>
    </div>

    <!-- Column 3: Review -->
    <div class="kanban-column">
      <div class="column-header review-header">
        <h3>ğŸ‘ï¸ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h3>
        <span class="task-count">{{ reviewCount }}</span>
      </div>
      
      <div 
        class="tasks-list"
        cdkDropList
        #reviewList="cdkDropList"
        [cdkDropListData]="reviewTasks"
        [cdkDropListConnectedTo]="[todoList, inProgressList, completedList]"
        (cdkDropListDropped)="drop($event, 'in-progress')">
        
        <div 
          *ngFor="let task of reviewTasks"
          class="task-card"
          cdkDrag
          [cdkDragData]="task"
          [style.border-left-color]="getPriorityColor(task.priority)">
          
          <div class="drag-handle" cdkDragHandle>â‹®â‹®</div>
          
          <div class="task-content">
            <h4>{{ task.title }}</h4>
            <p *ngIf="task.description">{{ task.description }}</p>
            
            <div *ngIf="task.tags && task.tags.length > 0" class="task-tags">
              <span *ngFor="let tag of task.tags" class="tag">{{ tag }}</span>
            </div>
            
            <div class="task-footer">
              <div class="task-meta">
                <span class="task-priority" [style.color]="getPriorityColor(task.priority)">
                  {{ getPriorityLabel(task.priority) }}
                </span>
                <span class="task-date">{{ task.date }}</span>
              </div>
              
              <div class="task-actions">
                <button (click)="deleteTask(task)" class="btn-icon-small" title="Ø­Ø°Ù">
                  ğŸ—‘ï¸
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div *ngIf="reviewTasks.length === 0" class="empty-column">
          Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…
        </div>
      </div>
    </div>

    <!-- Column 4: Completed -->
    <div class="kanban-column">
      <div class="column-header completed-header">
        <h3>âœ… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</h3>
        <span class="task-count">{{ completedCount }}</span>
      </div>
      
      <div 
        class="tasks-list"
        cdkDropList
        #completedList="cdkDropList"
        [cdkDropListData]="completedTasks"
        [cdkDropListConnectedTo]="[todoList, inProgressList, reviewList]"
        (cdkDropListDropped)="drop($event, 'done')">
        
        <div 
          *ngFor="let task of completedTasks"
          class="task-card completed"
          cdkDrag
          [cdkDragData]="task"
          [style.border-left-color]="getPriorityColor(task.priority)">
          
          <div class="drag-handle" cdkDragHandle>â‹®â‹®</div>
          
          <div class="task-content">
            <h4>{{ task.title }}</h4>
            <p *ngIf="task.description">{{ task.description }}</p>
            
            <div *ngIf="task.tags && task.tags.length > 0" class="task-tags">
              <span *ngFor="let tag of task.tags" class="tag">{{ tag }}</span>
            </div>
            
            <div class="task-footer">
              <div class="task-meta">
                <span class="task-priority" [style.color]="getPriorityColor(task.priority)">
                  {{ getPriorityLabel(task.priority) }}
                </span>
                <span class="task-date">{{ task.date }}</span>
              </div>
              
              <div class="task-actions">
                <button (click)="deleteTask(task)" class="btn-icon-small" title="Ø­Ø°Ù">
                  ğŸ—‘ï¸
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div *ngIf="completedTasks.length === 0" class="empty-column">
          Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…
        </div>
      </div>
    </div>
  </div>
</div>

<!-- New Task Modal -->
<div *ngIf="showNewTaskModal" class="modal-overlay" (click)="closeNewTaskModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h2>â• Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
    
    <div class="form-group">
      <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø© *</label>
      <input type="text"
             [(ngModel)]="newTask.title"
             placeholder="Ù…Ø«Ø§Ù„: Ø¥Ù†Ø´Ø§Ø¡ ØªØµÙ…ÙŠÙ… Ù„Ù„Ø­Ù…Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©"
             class="form-control">
    </div>
    
    <div class="form-group">
      <label>Ø§Ù„ÙˆØµÙ</label>
      <textarea [(ngModel)]="newTask.description"
                placeholder="ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ù…Ù‡Ù…Ø©..."
                rows="4"
                class="form-control"></textarea>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label>Ø§Ù„Ø­Ø§Ù„Ø©</label>
        <select [(ngModel)]="newTask.status" class="form-control">
          <option value="todo">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</option>
          <option value="in-progress">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option>
          <option value="done">Ù…ÙƒØªÙ…Ù„Ø©</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
        <select [(ngModel)]="newTask.priority" class="form-control">
          <option *ngFor="let p of priorityOptions" [value]="p.value">
            {{ p.label }}
          </option>
        </select>
      </div>
    </div>
    
    <div class="form-group">
      <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</label>
      <input type="date"
             [(ngModel)]="newTask.dueDate"
             class="form-control">
    </div>
    
    <div class="form-group">
      <label>Ø§Ù„ÙˆØ³ÙˆÙ…</label>
      <div class="tags-selector">
        <button *ngFor="let tag of availableTags"
                type="button"
                (click)="toggleTag(tag)"
                [class.selected]="newTask.tags?.includes(tag)"
                class="tag-btn">
          {{ tag }}
        </button>
      </div>
    </div>
    
    <div class="modal-actions">
      <button (click)="closeNewTaskModal()" class="btn-cancel">
        Ø¥Ù„ØºØ§Ø¡
      </button>
      <button (click)="createTask()" class="btn-primary">
        Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©
      </button>
    </div>
  </div>
</div>