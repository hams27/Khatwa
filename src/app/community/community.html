<app-side-bar></app-side-bar>

<div class="community-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner"></div>
    <p>ุฌุงุฑู ุชุญููู ุงููุฌุชูุน...</p>
  </div>

  <!-- Success/Error Messages -->
  <div *ngIf="successMessage" class="success-banner">
    โ {{ successMessage }}
  </div>

  <div *ngIf="errorMessage" class="error-banner">
    โ {{ errorMessage }}
  </div>

  <!-- Header -->
  <div class="community-header">
    <h1>๐ฌ ุงููุฌุชูุน</h1>
    <div class="header-actions">
      <button (click)="openNewPostModal()" class="btn-primary">
        โ ููุดูุฑ ุฌุฏูุฏ
      </button>
      <button (click)="refreshCommunity()" class="btn-refresh">
        ๐ ุชุญุฏูุซ
      </button>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="summary-grid">
    <div *ngFor="let card of summaryCards" 
         class="summary-card" 
         [ngClass]="card.color">
      <div class="card-icon">{{ card.icon }}</div>
      <div class="card-content">
        <h3>{{ card.title }}</h3>
        <p *ngIf="!card.loading" class="card-value">{{ card.value }}</p>
        <div *ngIf="card.loading" class="skeleton-loader"></div>
      </div>
    </div>
  </div>

  <!-- Filters & Search -->
  <div class="filters-section">
    <div class="filter-buttons">
      <button *ngFor="let filter of availableFilters"
              (click)="changeFilter(filter.value)"
              [class.active]="selectedFilter === filter.value"
              class="filter-btn">
        {{ filter.icon }} {{ filter.label }}
      </button>
    </div>
    
    <div class="search-box">
      <input type="text"
             [(ngModel)]="searchQuery"
             (input)="searchPosts()"
             placeholder="๐ ุงุจุญุซ ูู ุงูููุดูุฑุงุช..."
             class="search-input">
    </div>
  </div>

  <!-- Posts List -->
  <div class="posts-section">
    <div *ngFor="let post of posts" class="post-card">
      
      <!-- Post Header -->
      <div class="post-header">
        <div class="author-info">
          <div class="author-avatar">{{ post.author?.charAt(0) || 'ู' }}</div>
          <div class="author-details">
            <h3>{{ post.author }}</h3>
            <span class="post-time">{{ post.timeAgo }}</span>
          </div>
        </div>
        
        <button *ngIf="isMyPost(post)" 
                (click)="deletePost(post)"
                class="btn-delete">
          ๐๏ธ
        </button>
      </div>

      <!-- Post Content -->
      <div class="post-content">
        <h2 *ngIf="post.title">{{ post.title }}</h2>
        <p>{{ post.content }}</p>
        
        <!-- Tags -->
        <div *ngIf="post.tags && post.tags.length > 0" class="post-tags">
          <span *ngFor="let tag of post.tags" 
                (click)="filterByTag(tag)"
                class="tag">
            #{{ tag }}
          </span>
        </div>
      </div>

      <!-- Post Actions -->
      <div class="post-actions">
        <button (click)="toggleLike(post)" 
                class="action-btn"
                [class.liked]="post.isLiked">
          {{ post.isLiked ? 'โค๏ธ' : '๐ค' }} 
          {{ post.likesCount || 0 }}
        </button>
        
        <button (click)="toggleComments(post)" class="action-btn">
          ๐ฌ {{ post.commentsCount || 0 }}
        </button>
      </div>

      <!-- Comments Section -->
      <div *ngIf="post.showComments" class="comments-section">
        
        <!-- Loading Comments -->
        <div *ngIf="post.loadingComments" class="loading-comments">
          ุฌุงุฑู ุชุญููู ุงูุชุนูููุงุช...
        </div>

        <!-- Comments List -->
        <div *ngIf="!post.loadingComments" class="comments-list">
          <div *ngFor="let comment of post.comments" class="comment-item">
            <div class="comment-avatar">{{ comment.User?.name?.charAt(0) || 'ู' }}</div>
            <div class="comment-content">
              <h4>{{ comment.User?.name || 'ูุณุชุฎุฏู' }}</h4>
              <p>{{ comment.content }}</p>
            </div>
          </div>
          
          <div *ngIf="post.comments?.length === 0" class="no-comments">
            ูุง ุชูุฌุฏ ุชุนูููุงุช ุญุชู ุงูุขู. ูู ุฃูู ูู ูุนูู!
          </div>
        </div>

        <!-- Add Comment Form -->
        <div class="add-comment-form">
          <input type="text"
                 [(ngModel)]="newCommentContent[post.id!]"
                 (keyup.enter)="addComment(post)"
                 placeholder="ุฃุถู ุชุนูููุงู..."
                 class="comment-input">
          <button (click)="addComment(post)" class="btn-send">
            โ๏ธ
          </button>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="posts.length === 0 && !isLoading" class="empty-state">
      <p>๐ ูุง ุชูุฌุฏ ููุดูุฑุงุช ุญุงููุงู. ูู ุฃูู ูู ููุดุฑ!</p>
      <button (click)="openNewPostModal()" class="btn-primary">
        ุฅูุดุงุก ููุดูุฑ
      </button>
    </div>
  </div>

  <!-- Top Topics Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-card">
      <h3>๐ท๏ธ ุงูููุงุถูุน ุงูุดุงุฆุนุฉ</h3>
      <div class="topics-list">
        <div *ngFor="let topic of topTopics" 
             (click)="filterByTag(topic.name)"
             class="topic-item">
          <span class="topic-name">#{{ topic.name }}</span>
          <span class="topic-count">{{ topic.posts }}</span>
        </div>
      </div>
      
      <div *ngIf="topTopics.length === 0" class="no-topics">
        ูุง ุชูุฌุฏ ููุงุถูุน ุดุงุฆุนุฉ ุญุชู ุงูุขู
      </div>
    </div>
  </aside>
</div>

<!-- New Post Modal -->
<div *ngIf="showNewPostModal" class="modal-overlay" (click)="closeNewPostModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h2>โ๏ธ ููุดูุฑ ุฌุฏูุฏ</h2>
    
    <div class="form-group">
      <label>ุนููุงู ุงูููุดูุฑ</label>
      <input type="text"
             [(ngModel)]="newPost.title"
             placeholder="ุงูุชุจ ุนููุงูุงู ุฌุฐุงุจุงู..."
             class="form-control">
    </div>
    
    <div class="form-group">
      <label>ุงููุญุชูู</label>
      <textarea [(ngModel)]="newPost.content"
                placeholder="ุดุงุฑู ุฃููุงุฑูุ ุฎุจุฑุงุชูุ ุฃู ุฃุณุฆูุชู..."
                rows="6"
                class="form-control"></textarea>
    </div>
    
    <div class="form-group">
      <label>ุงููุณูู (ุงุฎุชุฑ ูุงุญุฏ ุฃู ุฃูุซุฑ)</label>
      <div class="tags-selector">
        <button *ngFor="let tag of availableTags"
                (click)="toggleTag(tag)"
                [class.selected]="newPost.tags.includes(tag)"
                class="tag-btn">
          #{{ tag }}
        </button>
      </div>
    </div>
    
    <div class="modal-actions">
      <button (click)="closeNewPostModal()" 
              class="btn-cancel"
              [disabled]="isCreatingPost">
        ุฅูุบุงุก
      </button>
      <button (click)="createPost()" 
              class="btn-primary"
              [disabled]="isCreatingPost">
        <span *ngIf="!isCreatingPost">ูุดุฑ</span>
        <span *ngIf="isCreatingPost">ุฌุงุฑู ุงููุดุฑ...</span>
      </button>
    </div>
  </div>
</div>