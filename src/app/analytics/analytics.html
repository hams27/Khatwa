<app-side-bar (collapsedChange)="onSidebarToggle($event)"></app-side-bar>

<!-- ===== TOP NAV ===== -->
<nav class="top-nav" [class.sidebar-collapsed]="isSidebarCollapsed">
  <div class="nav-left">
    <div>
      <div class="nav-page-title">ุงูุชุญูููุงุช</div>
      <div class="nav-page-sub">ุฑุคู ุฐููุฉ ูุฃุฏุงุก ูุดุฑูุนู ููุณุงุฑ ูููู</div>
    </div>
  </div>
  <div class="nav-right">
    <label class="toggle-wrap">
      <div class="toggle-switch" [class.active]="autoRefreshEnabled" (click)="toggleAutoRefresh()">
        <div class="toggle-knob"></div>
      </div>
      <span class="toggle-lbl">ุชุญุฏูุซ ุชููุงุฆู</span>
    </label>
    <button class="btn-refresh" (click)="refreshAnalytics()" [disabled]="isLoading">
      <svg viewBox="0 0 16 16" fill="currentColor"><path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"/><path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"/></svg>
      ุชุญุฏูุซ
    </button>
    <button class="guide-btn" (click)="openGuide()">
      <svg viewBox="0 0 16 16" fill="white"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/></svg>
      ุฏููู ุงูุงุณุชุฎุฏุงู
    </button>
  </div>
</nav>

<!-- ===== GUIDE MODAL ===== -->
<div class="modal-overlay" *ngIf="showGuide" (click)="closeGuide()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>๐ ุฏููู ุงุณุชุฎุฏุงู ุงูุชุญูููุงุช</h3>
      <button class="close-btn" (click)="closeGuide()">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <p class="guide-intro">ููุญุฉ ุงูุชุญูููุงุช ุชุนุทูู ุฑุคูุฉ ุดุงููุฉ ูุฏูููุฉ ุนู ุฃุฏุงุก ูุดุฑูุนู.</p>
      <div class="guide-features">
        <div class="guide-item"><span class="guide-icon">๐</span><div><h4>ุฃุฏุงุก ุงูุฅูุฑุงุฏุงุช</h4><p>ุชุชุจุน ููู ุฅูุฑุงุฏุงุชู ุงููุนููุฉ ูุงููุชููุนุฉ</p></div></div>
        <div class="guide-item"><span class="guide-icon">๐ฏ</span><div><h4>ุฅูุฌุงุฒ ุงูููุงู</h4><p>ูุงุฑู ุงููุฎุทุท ุจุงูููุฌุฒ ุฃุณุจูุนูุงู</p></div></div>
        <div class="guide-item"><span class="guide-icon">๐</span><div><h4>ุงุชุฌุงูุงุช ุงูููู</h4><p>ุฑุตุฏ ููู ุงูุฅูุฑุงุฏุงุช ูุงูุนููุงุก ูุญุตุฉ ุงูุณูู</p></div></div>
        <div class="guide-item"><span class="guide-icon">๐ก</span><div><h4>ุฑุคู ุฐููุฉ</h4><p>ุชูุตูุงุช ูุจููุฉ ุนูู ุชุญููู ุจูุงูุงุชู ุงููุนููุฉ</p></div></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-primary" (click)="closeGuide()">ูููุชุ ุดูุฑุงู</button>
    </div>
  </div>
</div>

<!-- ===== MAIN ===== -->
<main class="analytics-main" [class.sidebar-collapsed]="isSidebarCollapsed">

  <!-- Loading -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>ุฌุงุฑู ุชุญููู ุงูุชุญูููุงุช...</p>
    </div>
  </div>

  <!-- Error -->
  <div class="error-banner" *ngIf="errorMessage">
    <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/></svg>
    {{ errorMessage }}
  </div>

  <!-- ===== WELCOME BANNER ===== -->
  <section class="welcome-section">
    <div class="welcome-content">
      <div class="welcome-text">
        <h1 class="welcome-title">ุงูุชุญูููุงุช ูุงูุฑุคู <span>๐</span></h1>
        <p class="welcome-sub">ุจูุงูุงุช ุฏูููุฉ ูุชููุนุงุช ุฐููุฉ ููุณุงุนุฏุชู ุนูู ุงุชุฎุงุฐ ูุฑุงุฑุงุช ุฃูุถู</p>
      </div>
      <div class="welcome-badges">
        <div class="w-badge">
          <span class="w-badge-icon">๐</span>
          <div>
            <span class="w-badge-lbl">ูุนุฏู ุงูููู</span>
            <span class="w-badge-val">+{{ statsCards[3]?.value || '0%' }}</span>
          </div>
        </div>
        <div class="w-badge">
          <span class="w-badge-icon">๐ฏ</span>
          <div>
            <span class="w-badge-lbl">ุฅูุฌุงุฒ ุงูููุงู</span>
            <span class="w-badge-val">{{ statsCards[1]?.value || '0%' }}</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== STATS CARDS ===== -->
  <section class="metrics-grid">
    <div class="mc" *ngFor="let card of statsCards; let i = index" [class]="'mc-' + card.color">
      <div class="mc-icon">{{ card.icon }}</div>
      <div class="mc-lbl">{{ card.title }}</div>
      <div class="mc-val" *ngIf="!card.loading">{{ card.value }}</div>
      <div class="mc-skeleton" *ngIf="card.loading"></div>
      <div class="mc-trend up" *ngIf="!card.loading && card.change.includes('+')">{{ card.change }}</div>
      <div class="mc-trend down" *ngIf="!card.loading && !card.change.includes('+')">{{ card.change }}</div>
      <div class="mini-prog">
        <div class="mini-prog-fill" [class]="'mpf-' + card.color" style="width:70%"></div>
      </div>
    </div>
  </section>

  <!-- ===== CHARTS ROW 1 ===== -->
  <div class="charts-row">

    <!-- Performance Chart (wide) -->
    <div class="chart-card wide">
      <div class="chart-head">
        <div>
          <div class="chart-title">๐ ุงูุฃุฏุงุก ุงูุนุงู</div>
          <div class="chart-sub">ุงูุฅูุฑุงุฏุงุช ูุฅูุฌุงุฒ ุงูููุงู ูุฑุถุง ุงูุนููุงุก โ ุขุฎุฑ 6 ุฃุดูุฑ</div>
        </div>
        <span class="chip chip-g">โ 15%</span>
      </div>
      <div style="height:260px"><canvas #performanceChart></canvas></div>
    </div>

    <!-- Task Completion (narrow) -->
    <div class="chart-card">
      <div class="chart-head">
        <div>
          <div class="chart-title">โ ุฅูุฌุงุฒ ุงูููุงู</div>
          <div class="chart-sub">ุงููุฎุทุท ููุงุจู ุงูููุชูู ุฃุณุจูุนูุงู</div>
        </div>
      </div>
      <div style="height:260px"><canvas #taskCompletionChart></canvas></div>
    </div>

  </div>

  <!-- ===== CHARTS ROW 2 ===== -->
  <div class="charts-row" style="margin-bottom:16px">

    <!-- Revenue Projection (wide) -->
    <div class="chart-card wide">
      <div class="chart-head">
        <div>
          <div class="chart-title">๐ฐ ุชููุนุงุช ุงูุฅูุฑุงุฏุงุช</div>
          <div class="chart-sub">ุงููุนูู ููุงุจู ุงููุชููุน ููุงูู ุงูุณูุฉ</div>
        </div>
        <span class="chip chip-b">ุชููุนุงุช 2025</span>
      </div>
      <div style="height:240px"><canvas #revenueProjectionChart></canvas></div>
    </div>

    <!-- Growth Trend (narrow) -->
    <div class="chart-card">
      <div class="chart-head">
        <div>
          <div class="chart-title">๐ ุงุชุฌุงูุงุช ุงูููู</div>
          <div class="chart-sub">ุงูุฅูุฑุงุฏุงุช ูุงูุนููุงุก ูุญุตุฉ ุงูุณูู</div>
        </div>
      </div>
      <div style="height:240px"><canvas #growthTrendChart></canvas></div>
    </div>

  </div>

  <!-- ===== INSIGHTS ===== -->
  <div class="bottom-grid">

    <!-- AI Insights -->
    <div class="card insights-card">
      <div class="card-head">
        <div class="card-title">๐ก ุฑุคู ุฐููุฉ ูุชููุนุงุช</div>
        <span class="ai-badge">AI</span>
      </div>
      <div class="insights-list" *ngIf="insights.length > 0; else noInsights">
        <div class="insight-item" *ngFor="let insight of insights" [class]="'ins-' + insight.type">
          <div class="ins-icon">
            <svg *ngIf="insight.type === 'success'" viewBox="0 0 16 16" fill="currentColor"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M6.97 11.03a.75.75 0 0 0 1.08.022l3.992-4.99a.75.75 0 0 0-1.071-1.05L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06z"/></svg>
            <svg *ngIf="insight.type === 'warning'" viewBox="0 0 16 16" fill="currentColor"><path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/></svg>
            <svg *ngIf="insight.type === 'info'" viewBox="0 0 16 16" fill="currentColor"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/></svg>
            <svg *ngIf="insight.type === 'danger'" viewBox="0 0 16 16" fill="currentColor"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg>
          </div>
          <div class="ins-body">
            <div class="ins-title">{{ insight.title }}</div>
            <div class="ins-desc">{{ insight.description }}</div>
          </div>
          <div class="ins-confidence">
            <div class="conf-num">{{ insight.confidence }}%</div>
            <div class="conf-lbl">ููุซูููุฉ</div>
          </div>
        </div>
      </div>
      <ng-template #noInsights>
        <div class="empty-state">
          <div class="empty-icon">๐ก</div>
          <p>ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...</p>
        </div>
      </ng-template>
    </div>

    <!-- Quick Stats & Export -->
    <div class="side-col">

      <!-- KPI Summary -->
      <div class="card">
        <div class="card-head">
          <div class="card-title">๐ ููุฎุต ุงููุคุดุฑุงุช</div>
          <span class="chip chip-g">ูุฐุง ุงูุดูุฑ</span>
        </div>
        <div class="kpi-list">
          <div class="kpi-row">
            <span class="kpi-lbl">๐ ุฃุนูู ุฅูุฑุงุฏ ุดูุฑู</span>
            <span class="kpi-val g">32,000 ุฑ.ุณ</span>
          </div>
          <div class="kpi-row">
            <span class="kpi-lbl">๐ฏ ุฃูุถู ุฃุณุจูุน ุฅูุฌุงุฒ</span>
            <span class="kpi-val g">92%</span>
          </div>
          <div class="kpi-row">
            <span class="kpi-lbl">๐ ูุชูุณุท ููู ุดูุฑู</span>
            <span class="kpi-val g">+18%</span>
          </div>
          <div class="kpi-row">
            <span class="kpi-lbl">๐ ุนุฏุฏ ุงูุนููุงุก ุงูุฌุฏุฏ</span>
            <span class="kpi-val b">32</span>
          </div>
          <div class="kpi-row">
            <span class="kpi-lbl">๐ ูุนุฏู ุงููุงูุฏ</span>
            <span class="kpi-val r">4.2%</span>
          </div>
          <div class="kpi-row">
            <span class="kpi-lbl">โญ ุฑุถุง ุงูุนููุงุก</span>
            <span class="kpi-val g">85%</span>
          </div>
        </div>
      </div>

      <!-- Export -->
      <div class="card">
        <div class="card-head">
          <div class="card-title">๐ค ุชุตุฏูุฑ ุงูุชูุงุฑูุฑ</div>
        </div>
        <div class="export-grid">
          <button class="exp-btn" (click)="exportData('pdf')">
            <div class="exp-icon">๐</div>
            <span>ุชุตุฏูุฑ PDF</span>
          </button>
          <button class="exp-btn" (click)="exportData('excel')">
            <div class="exp-icon">๐</div>
            <span>ุชุตุฏูุฑ Excel</span>
          </button>
        </div>
        <div class="auto-refresh-row">
          <span class="ar-lbl">ุชุญุฏูุซ ุชููุงุฆู ูู 5 ุฏูุงุฆู</span>
          <div class="toggle-switch sm" [class.active]="autoRefreshEnabled" (click)="toggleAutoRefresh()">
            <div class="toggle-knob"></div>
          </div>
        </div>
      </div>

    </div>

  </div><!-- end bottom-grid -->

</main>